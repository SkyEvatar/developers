# 3. 区块链系统的互操作 API

## 3.1 账户管理

### 3.1.1 账户注册

方法:createAccountWithPassword

功能:账户注册

| 参数      | 说明             | 类型    | 默认值 |
| --------- | ---------------- | ------- | ------ |
| account   | 用户名           | string  | -      |
| password  | 密码             | string  | -      |
| autoLogin | 指定是否自动登录 | boolean | false  |
| callback  | 回调函数         | string  | -      |

### 3.1.2 账户登录

方法:passwordLogin

功能:账户登录

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| account  | 用户名          | string   | -      |
| password | 密码            | string   | -      |
| callback | 见统一 API 说明 | function | -      |

### 3.1.3 私钥登录

方法:privateKeyLogin

功能:导入私钥。该方法将会使用临时密码对明文私钥进行双重加密，该密码每次导入私钥的时候可以设置不同的密码

| 参数       | 说明                                      | 类型     | 默认值 |
| ---------- | ----------------------------------------- | -------- | ------ |
| privateKey | 明文私钥                                  | string   | -      |
| password   | 临时密码,每次导入私钥时可以设置不同的密码 | string   | -      |
| callback   | 见统一 API 说明                           | function | -      |

### 3.1.4 退出登录

方法:logout

功能:清除用户相关缓存信息,其中包括清除加密后的非明文 key

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| callback | 见统一 API 说明 | function | -      |

### 3.1.5 修改密码

方法:changePassword

功能: 在以下两种情况能修改密码=>1 账户密码登录模式，旧密码即创建账户时的原始密码；2 ownerPrivateKey 导入登录模式，旧密码为导入时设置的临时密码。注：activePrivateKey 不能修改密码

| 参数        | 说明                                         | 类型     | 默认值 |
| ----------- | -------------------------------------------- | -------- | ------ |
| oldPassword | 原始密码/导入 ownerPrivateKey 设置的临时密码 | string   | -      |
| newPassword | 新密码                                       | string   | -      |
| callback    | 修改密码成功后,API 将会自动调用退出登录。    | function | -      |

### 3.1.6 导出用户私钥

方法:getPrivateKey

功能:获取用户 Active PrivateKey,本秘钥可用于为账户所有花费行为签名

| 参数     | 说明                                                                                                   | 类型     | 默认值 |
| -------- | ------------------------------------------------------------------------------------------------------ | -------- | ------ |
| callback | 返回对象结构为： `{status:1,data:{activePrivateKey:”****\*\*\*****”}}`, 其中:activePrivateKey 为私钥串 | function | -      |

### 3.1.7 解锁账户

方法:unlockAccount

功能:导入私钥后才可以使用此方法解锁账户

| 参数     | 说明                     | 类型     | 默认值   |
| -------- | ------------------------ | -------- | -------- |
| password | 导入私钥时设置的临时密码 | string   | 空字符串 |
| callback | -                        | function | -        |

### 3.1.8 锁定账户

方法:lockAccount

功能:锁定账户

| 参数     | 说明 | 类型     | 默认值 |
| -------- | ---- | -------- | ------ |
| callback | -    | function | -      |

### 3.1.9 查询账户记录

方法:queryUserOperations

功能:查询用户近期操作记录

| 参数     | 说明         | 类型     | 默认值 |
| -------- | ------------ | -------- | ------ |
| account  | 账户名       | string   | -      |
| limit    | 查询记录条数 | number   | -      |
| callback | -            | function | -      |

### 3.1.10 订阅用户操作记录变更

方法:subscribeToUserOperations

功能:订阅用户操作记录变更

| 参数     | 说明                                      | 类型     | 默认值 |
| -------- | ----------------------------------------- | -------- | ------ |
| account  | 账户名                                    | string   | -      |
| callback | 只要用户操作记录有变化，就调用此 callback | function | -      |

### 3.1.11 查询账户信息

方法:queryUserInfo

功能:账户信息中包含用户 id 用户名等信息

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| account  | 账户名          | string   | -      |
| callback | 见统一 API 说明 | function | -      |

## 3.2 代币操作

### 3.2.1 查询用户指定代币资产

方法:queryAccountBalances

功能:获取用户对应的数字资产，如果 assetID_or_symbol 为空，则返回用户所有道具。

| 参数              | 说明                                                                                                                                      | 类型     | 默认值 |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------ |
| account           | 账户名                                                                                                                                    | string   | -      |
| assetId_or_symbol | 资产 ID 或代币符号，资产 ID:数字代币的唯一代币标识 ID(如:”1.3.0”)，代币符号 (如:”MTN”), 如果 assetID_or_symbol 为空，则返回用户所有代币。 | string   | -      |
| callback          | 见统一 API 说明                                                                                                                           | function | -      |

### 3.2.2 查询用户拥有的所有资产列表

方法:queryAccountAllBalances

功能:查询用户拥有的所有资产列表，列表中包含资产对记账单位的换算值

参数:

- unit:记账单位，将会根据交易市场价格换算等价的该资产，资产 ID 或代币符号，资产 ID:数字代币的唯一代币 标识 ID(如:”1.3.0”)，代币符号(如:”MTN”)
- account:用户名
- callback:

| 参数     | 说明                                                                                                                                         | 类型     | 默认值               |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------------- | -------- | -------------------- |
| account  | 账户名                                                                                                                                       | string   | -                    |
| unit     | 记账单位，将会根据交易市场价格换算等价的该资产，资产 ID 或代币符号，资产 ID：数字代币的唯一代币标识 ID（如：”1.3.0”），代币符号（如：”MTN”） | string   | 1.3.0（核心资产 ID） |
| callback | 见统一 API 说明                                                                                                                              | function | -                    |

### 3.2.3 代币资产转移

方法:transferAsset

功能:向目标对象发送代币

参数:

- to: 收款方账号名
- amount:发送的代币数量
- assetId :资产 ID (如:1.3.0)或 代币符号(如:MTN)
- memo: 转账备注
- callback: 设置转账后的回调函数

| 参数     | 说明                                                        | 类型     | 默认值               |
| -------- | ----------------------------------------------------------- | -------- | -------------------- |
| to       | 收款方账号名                                                | string   | -                    |
| amount   | 发送的代币数量                                              | number   | 0                    |
| assetId  | 发送的代币种类。资产 ID （如：1.3.0）或 代币符号（如：MTN） | string   | 1.3.0（核心资产 ID） |
| memo     | 转账备注                                                    | string   | -                    |
| callback | 见统一 API 说明                                             | function | -                    |

## 3.3 游戏道具操作

### 3.3.1 创建游戏版本

方法:createGameVersion

功能:创建游戏支持的道具版本，向区块链系统注册当前账号(通常为游戏的账号)支持的道具版本

| 参数        | 说明            | 类型     | 默认值 |
| ----------- | --------------- | -------- | ------ |
| versionName | 版本名称        | string   | -      |
| callback    | 见统一 API 说明 | function | -      |

### 3.3.2 创造道具

方法:createGameItem

功能:创建一个唯一的游戏道具，具有唯一性。本接口仅限道具制造商(铁匠铺)使用。

| 参数                                | 说明                                                                                                                                                                                                                                   | 类型     | 默认值          |
| ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | --------------- |
| itemVER                             | 道具版本(当 type 为 1 时不传该参数)                                                                                                                                                                                                    | string   | -               |
| 道具版本(当 type 为 1 时不传该参数) | 当前道具交易时，适用的资产 ID；(当 type 为 1 时不传该参数)                                                                                                                                                                             | string   | -               |
| itemData                            | 当前道具的具体内容描述，由制造者定义;(当 type 为 1 时不传该参数)                                                                                                                                                                       | string   | -               |
| itemCount                           | 创建道具的数量，为可选参数，只有在 type 为 0 的时候有用。(当 type 为 1 时不传该参数)                                                                                                                                                   | number   | 1               |
| type                                | 创建道具方式：默认值为 0，0 是创建同一种道具，1 是创建不同道具                                                                                                                                                                         | number   | 1               |
| items                               | 当 type 为 1 时才传该参数,示例: [{"assetId":"1.3.0","itemVER":"LRS","itemData":"{name:\"预言家\"}"},{"assetId":"1.3.0","itemVER":"LRS","itemData":"{name:\"女巫\"}"},{"assetId":"1.3.0","itemVER":"LRS","itemData":"{name:\"猎人\"}"}] | array    | 长度为 0 的数组 |
| callback                            | 见统一 API 说明                                                                                                                                                                                                                        | function | -               |

### 3.3.3 删除游戏道具

方法:deleteGameItem

功能:删除整条游戏道具数据记录,通常在商品销毁时使用(仅能由用户自己授权处理自己想要销毁的数据)。

| 参数     | 说明                                                     | 类型     | 默认值 |
| -------- | -------------------------------------------------------- | -------- | ------ |
| itemIds  | 游戏道具实例的唯一标识 ID 的集合;示例：[3.2.195,3.2.194] | array    | []     |
| callback | 见统一 API 说明                                          | function | -      |

### 3.3.4 更新游戏道具数据

方法:updateGameItem

功能:更新游戏道具数据，写入一个新的 itemData

| 参数        | 说明                                   | 类型     | 默认值   |
| ----------- | -------------------------------------- | -------- | -------- |
| itemId      | 游戏道具实例的唯一标识 ID;             | string   | -        |
| newItemData | 写入一个新的 itemData;(可传入空字符串) | string   | 空字符串 |
| callback    | 见统一 API 说明                        | function | -        |

### 3.3.5 转移游戏道具

方法:transferGameItem

功能:用户可以将自己的道具转移到另外一个用户

| 参数      | 说明                                                                      | 类型     | 默认值 |
| --------- | ------------------------------------------------------------------------- | -------- | ------ |
| toAccount | 转移道具的目标用户名                                                      | string   | -      |
| itemId    | 游戏道具实例的唯一标识 ID                                                 | string   | -      |
| type      | 默认为 0，当为 1 时表示批量转移                                           | number   | 0      |
| itemIds   | 多个道具 id 组成的数组，示例:[3.2.332,3.2.333]。当 type 为 1 时传入该参数 | array    | []     |
| callback  | 见统一 API 说明                                                           | function | -      |

### 3.3.6 提议关联游戏版本

方法:proposeRelateGameVersion

功能:提议关联到某一个游戏版本，需要该版本的创建人审批

| 参数         | 说明                   | 类型     | 默认值 |
| ------------ | ---------------------- | -------- | ------ |
| gameVersion  | 需要关联的版本名       | string   | -      |
| versionOwner | 需要关联的版本的创建者 | string   | -      |
| callback     | 见统一 API 说明        | function | -      |

### 3.3.7 批准关联游戏版本的提议

方法:submitProposal

功能:批准其他用户关联自己的版本的提议，如果不同意提议，无需进行该操作，提议会自动过期

| 参数       | 说明            | 类型     | 默认值 |
| ---------- | --------------- | -------- | ------ |
| proposalId | 提议 Id         | string   | -      |
| callback   | 见统一 API 说明 | function | -      |

### 3.3.8 获取当前用户收到的提议

方法:getAccountProposals

功能:获取当前操作用户收到的提议

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| callback | 见统一 API 说明 | function | -      |

## 3.4 游戏道具买卖

### 3.4.1 购买订单道具

方法:fillGameItemOrder

功能:买入道具，支付购买游戏装备的代币费用，同时修改用户拥有的商品数据。

| 参数             | 说明                                              | 类型     | 默认值 |
| ---------------- | ------------------------------------------------- | -------- | ------ |
| orderId          | 订单 ID                                           | string   | -      |
| seller           | 收款方                                            | string   | -      |
| itemId           | 游戏道具实例的唯一标识 ID                         | string   | -      |
| priceAmount      | 接收代币数量，代币种类与商品要求的 assetId 一致   | number   | -      |
| priceAssetId     | 资产 ID，用于描述当前游戏道具交易时使用的代币种类 | string   | -      |
| priceAssetSymbol | 资产符号即代币符号                                | string   | -      |
| callback         | 见统一 API 说明                                   | function | -      |

### 3.4.2 创建道具出售单

方法:creatGameItemOrder

功能:卖出道具(在交易前可调用 queryAccountGameItems 函数，列举用户道具，以便用户选着卖出)

| 参数       | 说明                                                          | 类型     | 默认值 |
| ---------- | ------------------------------------------------------------- | -------- | ------ |
| otcAccount | OTC 交易平台账户，用于收取挂单费用；（OTC 平台填写）          | string   | -      |
| orderFee   | 挂单费用，用户向 OTC 平台账户支付的挂单费用；（OTC 平台填写） | string   | -      |
| itemId     | 游戏道具实例的唯一标识 ID; （用户填写）                       | string   | -      |
| price      | 商品挂单价格；（用户填写）                                    | string   | -      |
| expiration | 挂单时间，如 60\*60=3600(秒)，为 1 小时                       | number   | -      |
| memo       | 挂单备注信息；可不填                                          | string   | -      |
| callback   | 见统一 API 说明                                               | function | -      |

### 3.4.3 取消道具出售单

方法:cancelGameItemOrder

功能:取消道具挂卖订单(调用 queryGameItemOrders 函数，列举当前全网用户的挂卖道具订单，以便用户选着
买入)

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| orderId  | 订单 ID         | string   | -      |
| callback | 见统一 API 说明 | function | -      |

## 3.5 道具查询

### 3.5.1 查询全网用户道具售卖订单

方法:queryGameItemOrders

功能:查询全网用户道具的售卖订单

| 参数              | 说明                                               | 类型     | 默认值 |
| ----------------- | -------------------------------------------------- | -------- | ------ |
| assetSymbolsOrIds | 资产符号或 id 筛选条件，默认查询所有资产类型的道具 | array    | []     |
| versionNameOrIds  | 版本名称筛选条件，默认查询所有版本                 | array    | []     |
| pageSize          | 页容量                                             | number   | 10     |
| page              | 页数                                               | number   | 1      |
| callback          | 见统一 API 说明                                    | function | -      |

### 3.5.2 查询账户下的游戏道具售卖订单

方法:queryAccountGameItemOrders

功能:查询指定用户的道具售卖订单

| 参数     | 说明                | 类型     | 默认值 |
| -------- | ------------------- | -------- | ------ |
| account  | 查询账户名或账户 Id | string   | -      |
| pageSize | 页容量              | number   | 10     |
| page     | 页数                | number   | 1      |
| callback | 见统一 API 说明     | function | -      |

### 3.5.3 查询账户下所拥有的道具

方法:queryAccountGameItems

功能:读取当前用户账户下所有可在对应游戏中使用的道具

| 参数             | 说明                               | 类型     | 默认值 |
| ---------------- | ---------------------------------- | -------- | ------ |
| account          | 查询账户名或账户 Id                | string   | -      |
| versionNameOrIds | 版本名称筛选条件，默认查询所有版本 | string   | -      |
| pageSize         | 页容量                             | number   | 10     |
| page             | 页数                               | number   | 1      |
| callback         | 见统一 API 说明                    | function | -      |

### 3.5.4 查询游戏开发者所关联的游戏版本

方法:queryDeveloperGameVersions

功能:查询游戏开发者所关联的游戏版本

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| account  | 账户名或账户 ID | string   | -      |
| callback | 见统一 API 说明 | function | -      |

### 3.5.5 查询游戏开发者创建的道具

方法:queryGameItemByDeveloper

功能:查询游戏开发者所创建的道具

| 参数     | 说明                | 类型     | 默认值 |
| -------- | ------------------- | -------- | ------ |
| account  | 查询账户名或账户 Id | string   | -      |
| callback | 见统一 API 说明     | function | -      |

## 3.6 节点投票

### 3.6.1 查询节点投票信息数据

方法:queryVotes

功能:加载节点投票信息数据

| 参数     | 说明            | 类型     | 默认值 |
| -------- | --------------- | -------- | ------ |
| callback | 见统一 API 说明 | function | -      |

### 3.6.2 账户投票

方法:publishVotes

功能:保存的时候设置了代理账户，用户投票信息将统一跟随代理账户

| 参数         | 说明                                                                                                | 类型     | 默认值 |
| ------------ | --------------------------------------------------------------------------------------------------- | -------- | ------ |
| witnessesIds | 节点账户 id 集合,查询节点投票信息数据中会有每个节点的账户 ID                                        | array    | -      |
| proxyAccount | 代理账户名，一旦设置代理账户，用户持有的票数将会计入代理账户投票中，此参数的优先级高于 witnessesIds | string   | -      |
| callback     | 见统一 API 说明                                                                                     | function | -      |
